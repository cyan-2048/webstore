last_check=null!=localStorage.versions?last_check=JSON.parse(localStorage.versions):last_check={non_existed:1},proxy=null!=localStorage.proxy?proxy=JSON.parse(localStorage.proxy):proxy="https://api.allorigins.win/raw?url=",ratings=null!=localStorage.ratings?ratings=JSON.parse(localStorage.ratings):ratings="https://bhackers.uber.space/srs/v1",database=null!=localStorage.database?database=JSON.parse(localStorage.database):database="https://banana-hackers.gitlab.io/store-db/data.json",new_versions={},(()=>{index=0;var e=!1;function t(){if(index+=1,index==data.apps.length||e)return index=0,e||(localStorage.versions=JSON.stringify(last_check)),void(e=!1);update()}cancel_update=()=>{e=!0},update=()=>{let e=data.apps[index];function a(a){last_check[e.slug]&&last_check[e.slug]!=a.version&&(new_versions[e.slug]={from:last_check[e.slug],to:a.version}),last_check[e.slug]=a.version,t()}fetch(e.download.manifest).then((e=>e.json())).then((e=>a(e))).catch((n=>{console.error(n),fetch(proxy+e.download.manifest).then((e=>e.json())).then((e=>a(e))).catch((e=>t()))}))}})();const database_init=()=>{fetch(database).then((e=>e.json())).catch((e=>{console.error(e),alert("can't download database please reload the page")})).then((e=>{data=e,"complete"===document.readyState||"interactive"===document.readyState?init():window.addEventListener("DOMContentLoaded",(()=>{let e;init(e)})),fetch(ratings+"/download_counter/").then((e=>e.json())).then((e=>{data.dl=e;let t=document.getElementById("sort");var a;"SEL"==t.tagName?((a=document.createElement("opt")).innerHTML='<i class="fas fa-fire-alt"></i>Popularity',a.setAttribute("value","pop"),t.querySelector("drop").appendChild(a)):((a=document.createElement("option")).innerText="Popularity",a.value="pop",t.add(a))})).catch((e=>{console.error(e),alert("can't download download counts, store will not have download count functionality")})).then((()=>{fetch(ratings+"/ratings").then((e=>e.json())).then((e=>{data.ratings=e;let t=document.getElementById("sort");var a;"SEL"==t.tagName?((a=document.createElement("opt")).innerHTML='<i class="fas fa-star"></i>Ratings',a.setAttribute("value","ra"),t.querySelector("drop").appendChild(a)):((a=document.createElement("option")).innerText="Ratings",a.value="ra",t.add(a))})).catch((e=>{console.error(e),alert("can't download download ratings, store will not have ratings functionality")}))}))}))};fetch(database).then((e=>e.json())).catch((e=>{console.error(e),alert("can't download database please reload the page")})).then((e=>{data=e,"complete"===document.readyState||"interactive"===document.readyState?init():window.addEventListener("DOMContentLoaded",(()=>{let e;init(e)})),fetch(ratings+"/download_counter/").then((e=>e.json())).then((e=>{data.dl=e;let t=document.getElementById("sort");var a;"SEL"==t.tagName?((a=document.createElement("opt")).innerHTML='<i class="fas fa-fire-alt"></i>Popularity',a.setAttribute("value","pop"),t.querySelector("drop").appendChild(a)):((a=document.createElement("option")).innerText="Popularity",a.value="pop",t.add(a))})).catch((e=>{console.error(e),alert("can't download download counts, store will not have download count functionality")})).then((()=>{fetch(ratings+"/ratings").then((e=>e.json())).then((e=>{data.ratings=e;let t=document.getElementById("sort");var a;"SEL"==t.tagName?((a=document.createElement("opt")).innerHTML='<i class="fas fa-star"></i>Ratings',a.setAttribute("value","ra"),t.querySelector("drop").appendChild(a)):((a=document.createElement("option")).innerText="Ratings",a.value="ra",t.add(a))})).catch((e=>{console.error(e),alert("can't download download ratings, store will not have ratings functionality")}))}))}));const init=e=>{var t=null==e?"app":document.querySelector("#category .selected").dataset.name;document.getElementById("category").innerHTML="<style></style>";var a=[];a.push("app");for(let e in data.categories)a.push(data.categories[e].name);var n="";a.forEach(((e,o)=>{var r=document.getElementById("category"),l=document.createElement("button"),c=e.toLocaleLowerCase(),s="fas fa-store";try{s=data.categories[c].icon}catch(e){}"app"==e?l.innerText=" All Apps":(l.innerText=" "+e,null!=data.categories[c].description&&(l.title=data.categories[c].description));var d=document.createElement("i");d.className=s,l.insertBefore(d,l.childNodes[0]),l.dataset.name=c,n+=`[data-sel="${c}"] + #apps div.${c}`,o==a.length-1?n+="{ display: flex !important}":n+=",",r.parentElement.dataset.sel=t,r.appendChild(l)})),document.querySelector(`#category [data-name='${t}']`).className="selected",document.getElementById("category").querySelector("style").innerHTML=n,sort(),document.getElementById("apps").children[0].innerHTML="";for(let e of data.apps){var o=document.createElement("div"),r=document.createElement("div");r.className="header";var l=document.createElement("img");l.src=e.icon,l.alt=" ",r.appendChild(l);var c=document.createElement("div");c.className="cat",c.innerText=e.meta.categories.map((e=>capitalize(e))).join(", ");var s=document.createElement("div");s.className="na",s.innerText=e.name;var d=document.createElement("div");d.className="au",d.innerText=e.author[0].split("<")[0];var i=document.createElement("div");i.className="teco",i.appendChild(c),i.appendChild(s),i.appendChild(d),r.appendChild(i),o.appendChild(r),o.appendChild(document.createTextNode(truncate(e.description,206)));var u=document.createElement("div");u.className="spacer",o.appendChild(u);var p=document.createElement("a");p.className="info",p.innerHTML='<i class="fas fa-info-circle"></i> Info',p.href=`#${e.slug}`;var m=document.createElement("a");m.href=e.download.url,m.innerHTML='<i class="fas fa-file-download"></i> Download';var g=null;navigator.userAgent.toLocaleLowerCase().includes("kaios")||((g=document.createElement("button")).className="share",g.innerHTML='<i class="far fa-clipboard"></i> Share');var h=document.createElement("div");h.className="bucon",h.appendChild(p),h.appendChild(m),null!=g&&h.appendChild(g),o.appendChild(h),o.className="app",o.dataset.slug=e.slug;for(let t of e.meta.categories)o.classList.add(t);document.getElementById("apps").children[0].appendChild(o)}null!=e?location.hash="":(document.querySelector("#splash #image").className="loaded",document.getElementById("splash").style="opacity: 0; visibility: hidden"),""!=location.hash&&hashManager(void 0),document.getElementById("le").innerText=document.querySelectorAll('[data-sel="app"] + #apps .app').length};var lastScroll=0;function sort(e){switch(data.apps.sort(((e,t)=>e.name.localeCompare(t.name))),document.getElementById("sort").selectedOptions?document.getElementById("sort").selectedOptions[0].value:document.querySelector("#sort cho").getAttribute("value")){case"cab":data.apps.sort(((e,t)=>e.meta.categories[0].localeCompare(t.meta.categories[0])));break;case"ra":data.apps.sort(((e,t)=>{var a=0;return!data.ratings[e.slug]||(data.ratings[t.slug]&&(a=data.ratings[t.slug].average_rating),data.ratings[e.slug].average_rating<a)}));break;case"pop":data.apps.sort(((e,t)=>{var a=0;return!data.dl[e.slug]||(data.dl[t.slug]&&(a=data.dl[t.slug]),data.dl[e.slug]<a)}))}null!=e&&e.target&&init(e)}window.addEventListener("DOMContentLoaded",(()=>{if((navigator.userAgent.toLocaleLowerCase().includes("kaios")?document.querySelector("sel"):document.querySelector("select")).remove(),"SELECT"==document.getElementById("sort").tagName&&(document.getElementById("sort").onchange=sort),document.getElementById("category").onclick=e=>{let t=e.target;if("BUTTON"==t.tagName){t.parentElement.parentElement.dataset.sel=t.dataset.name;for(let e of t.parentElement.children)e.removeAttribute("class");t.className="selected",document.getElementById("le").innerText=document.querySelectorAll(`[data-sel="${t.dataset.name}"] + #apps .${t.dataset.name}`).length}},!navigator.userAgent.toLocaleLowerCase().includes("kaios")){var e=document.createElement("button");e.id="scrollup";var t=document.createElement("i");t.className="fas fa-chevron-up",e.appendChild(t),document.body.appendChild(e),/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())?e.style.transform="none":document.getElementById("apps").addEventListener("wheel",(function(t){if(0!=document.body.scrollTop)if(t.deltaY<0&&"translateY(70px)"==e.style.transform)e.style.transform="none";else{if(!(t.deltaY>0&&"none"==e.style.transform))return;e.style.transform="translateY(70px)"}else e.style.transform="translateY(70px)"}))}})),document.onclick=e=>{if("OPT"==e.target.tagName){document.activeElement.blur();let t=e.target.parentElement.parentElement.children[0];t.innerHTML="";for(let a of e.target.childNodes){let e=a.cloneNode(!0);t.appendChild(e)}t.setAttribute("value",e.target.getAttribute("value")),sort(e)}else"share"==e.target.className?clipboard(location.origin+"/#"+e.target.parentElement.parentElement.dataset.slug):"scrollup"==e.target.id?document.body.scrollTo({top:0,behavior:"smooth"}):"cards"==e.target.id&&document.querySelector("#appcard .close").click()},window.onhashchange=hashManager;var info_open=!1;function hashManager(e){let t=location.hash.split("#")[1],a=document.querySelector(`.app[data-slug="${t}"]`);var n=200;if("app"==document.querySelector("#category").dataset.sel&&(n=0),null!=a&&""!=location.hash&&(null==e&&document.querySelector("button[data-name=app]").click(),setTimeout((()=>{const e=a.getBoundingClientRect(),t=e.top-document.body.getBoundingClientRect().top+e.height/2;document.body.scrollBy({left:0,top:t-window.innerHeight/2,behavior:"smooth"})}),n)),info_open&&""==location.hash)return void document.querySelector("#appcard .close").click();let o=data.apps.find((e=>e.slug==t));if(null==o)return;document.body.style.overflow="hidden";let r=document.getElementById("appcard");r.querySelector("#head img").src="",r.querySelector("#head img").src=o.icon,r.querySelector("#head img").alt="e",r.querySelector("#boxue #na").innerText=o.name,r.querySelector("#boxue #ca").innerText=o.meta.categories.map((e=>capitalize(e))).join(", "),r.querySelector("#boxue #de").innerText=o.author[0].split("<")[0];for(let e of r.querySelectorAll("#ave #to, #appcard > #de"))for(let t of e.childNodes)null!=t.id&&null!=t.className||t.remove();for(let e of r.querySelectorAll("#scr #img,#bucon,#spe ul,#chat"))e.innerHTML="";r.querySelector("#appcard > #de").appendChild(document.createTextNode(o.description));var l=document.createElement("a");if(l.href=o.download.url,l.innerText="Download",r.querySelector("#bucon").appendChild(l),0==o.screenshots.length)r.querySelector("#scr").style.display="none";else{r.querySelector("#scr").style="display: block";for(let e of o.screenshots){var c=document.createElement("img");c.src=e,c.onerror=e=>{e.target.remove()},r.querySelector("#scr #img").appendChild(c)}}function s(e,t){var a=document.createElement("li"),n=document.createElement("div");n.className="a",n.innerText=e,a.appendChild(n);var o=document.createElement("div");if(o.className="b","string"==typeof t)o.innerText=t;else if(Array.isArray(t))for(let e of t)o.appendChild(e);else o.appendChild(t);return a.appendChild(o),a}var d=r.querySelector("#spe ul");for(let e of["author","maintainer"])if(o[e]){if(o[e][0].includes("<")&&1==o[e].length){var i=document.createElement("a");let t=o[e][0].split("<")[1].split(">")[0];o[e][0].includes("@")?i.href="mailto:"+t:i.href=t,i.target="_blank",i.innerText=o[e][0].split("<")[0],m=i}else 1!=o[e].length?(m=[],o[e].forEach(((t,a)=>{if(t.includes("<")){var n=document.createElement("a");let e=t.split("<")[1].split(">")[0];t.includes("@")?n.href="mailto:"+e:n.href=e,n.innerText=t.split("<")[0],n.target="_blank",m.push(n)}else m.push(document.createTextNode(t));a!=o[e].length-1&&m.push(document.createTextNode(", "))}))):o[e][0].includes("<")||1!=o[e].length||(m=o[e][0]);var u="author"==e?"Developers":"Maintainers";d.appendChild(s(u,m))}for(let e of["website","git_repo","donation"])if(o[e]){var p=document.createElement("a");p.innerText=o[e],p.target="_blank",p.href=o[e];u="Repository";switch(e){case"website":case"donation":u=capitalize(e)}d.appendChild(s(u,p))}if(last_check[o.slug]&&d.appendChild(s("Version",last_check[o.slug])),d.appendChild(s("Type",capitalize(o.type))),o.locales&&d.appendChild(s("Languages",o.locales.join(", "))),d.appendChild(s("Anti-features",`Ads: ${o.has_ads}\n Tracking: ${o.has_tracking}`)),o.license){var m;if(o.license.includes("<")){i=document.createElement("a");let e=o.license.split("<")[1].split(">")[0];i.href=e,i.innerText=o.license.split("<")[0],i.target="_blank",m=i}else m=o.license;d.appendChild(s("License",m))}if(data.dl&&data.dl[o.slug]&&d.appendChild(s("Downloads",data.dl[o.slug].toString())),data.ratings&&data.ratings[o.slug]){let e=data.ratings[o.slug];r.querySelector("#ra").style.display="block",r.querySelector("#ave #sco").innerText=e.average_rating.toFixed("1"),r.querySelector("#ave #stars").style=`--stars:${e.average_rating/5*100}%`,r.querySelector("#ave #to").appendChild(document.createTextNode(`${e.rating_count} total`));for(let e of r.querySelectorAll("#cha *"))e.style="--to:0%";getAppRatings(o.slug,((t,a)=>{if(location.hash=="#"+o.slug&&"eroor404"!=t){[1,2,3,4,5].forEach((a=>{let n=t.ratings.filter((e=>e.points==a)).length;r.querySelector(`#appcard [data-r="${a}"]`).style=`--to:${n/e.rating_count*100}%`}));let a=r.querySelector("#chat");for(let e of t.ratings){var n=document.createElement("div"),l=document.createElement("div");l.className="tie",l.appendChild(document.createTextNode(`@${truncate(e.username,14)}`));var c=document.createElement("div");c.id="stars",c.style=`--stars:${e.points/5*100}%`,l.appendChild(c),l.appendChild(document.createTextNode(new Date(1e3*e.creationtime).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}))),n.appendChild(l),n.appendChild(document.createTextNode(e.description)),a.appendChild(n)}}}))}else r.querySelector("#ra").style.display="none";document.getElementById("cards").style="opacity:1;visibility:visible",document.getElementById("appcard").style="transform:translate(50%, -50%)",info_open=!0,document.querySelector("#appcard .close").addEventListener("click",(function e(){document.querySelector("#appcard .close").removeEventListener("click",e),info_open=!1,location.hash="",document.getElementById("cards").removeAttribute("style"),document.getElementById("appcard").removeAttribute("style"),document.body.style.overflow="auto"}))}function getAppRatings(e,t){fetch(`${ratings}/ratings/${e}`).then((e=>e.json())).then((e=>t(e))).catch((e=>t("eroor404",e)))}const capitalize=([e,...t],a=navigator.language)=>e.toLocaleUpperCase(a)+t.join(""),truncate=(e,t)=>e.length>t?e.substr(0,t-1)+"…":e;function clipboard(e){if(navigator.clipboard)navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(e){console.error("Async: Could not copy text: ",e)}));else{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var a=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+a)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}}