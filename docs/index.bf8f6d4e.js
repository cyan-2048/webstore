last_check=null!=localStorage.versions?last_check=JSON.parse(localStorage.versions):last_check={non_existed:1},proxy=null!=localStorage.proxy?proxy=JSON.parse(localStorage.proxy):proxy="https://api.allorigins.win/raw?url=",ratings=null!=localStorage.ratings?ratings=JSON.parse(localStorage.ratings):ratings="https://bhackers.uber.space/srs/v1",database=null!=localStorage.database?database=JSON.parse(localStorage.database):database="https://banana-hackers.gitlab.io/store-db/data.json",new_versions={},isKai=navigator.userAgent.toLocaleLowerCase().includes("kaios"),qr_prefix=null!=localStorage.qr_prefix?qr_prefix=JSON.parse(localStorage.qr_prefix):qr_prefix="bhacker:",(()=>{var e=0,t=!1;function a(){if(e+=1,document.querySelector("#check .bar").style.width=e/(data.apps.length-1)*100+"%",e==data.apps.length||t){e=0;let n=document.getElementById("check");if(n.style.animation="fadeout ease .4s",n.onanimationend=()=>n.remove(),t)toast({text:"checking for updates cancelled!",class:"danger"});else if(localStorage.versions=JSON.stringify(last_check),toast({text:"checking for updates was successful!",delay:5}),0==Object.keys(new_versions).length)toast({text:"No new updates",delay:5});else{var a="New updates: \n";Object.keys(new_versions).forEach((e=>{let t=new_versions;a+=`${data.apps.find((t=>t.slug==e)).name}: ${t[e].from} => ${t[e].to} \n`})),toast({text:a})}t=!1}else update()}cancel_update=()=>{t=!0},update=()=>{if(0==e){var n=document.createElement("div");n.className="blu",n.id="check",n.appendChild(document.createTextNode("Checking for updates..."));var l=document.createElement("div");l.className="progress",l.innerHTML="<div class=bar style='width:0%'></div>",n.appendChild(l);var o=document.createElement("button");o.id="close",o.innerHTML="<i class='fas fa-times'></i>",o.onclick=()=>{t=!0},n.appendChild(o),toast({element:n})}let r=data.apps[e];function c(e){last_check[r.slug]&&last_check[r.slug]!=e.version&&(new_versions[r.slug]={from:last_check[r.slug],to:e.version}),last_check[r.slug]=e.version,a()}fetch(r.download.manifest).then((e=>e.json())).then((e=>c(e))).catch((e=>{console.error(e),fetch(proxy+r.download.manifest).then((e=>e.json())).then((e=>c(e))).catch((e=>a()))}))}})();var e=()=>{fetch(database).then((e=>e.json())).catch((e=>{console.error(e),alert("can't download database please reload the page")})).then((e=>{data=e,"complete"===document.readyState||"interactive"===document.readyState?(t(),update()):window.addEventListener("DOMContentLoaded",(()=>{let e;t(e),update()})),fetch(ratings+"/download_counter/").then((e=>e.json())).then((e=>{data.dl=e;let t=document.getElementById("sort");var a;"SEL"==t.tagName?((a=document.createElement("opt")).innerHTML='<i class="fas fa-fire-alt"></i>Popularity',a.setAttribute("value","pop"),t.querySelector("drop").appendChild(a)):((a=document.createElement("option")).innerText="Popularity",a.value="pop",t.add(a))})).catch((e=>{console.error(e),toast({class:"danger",text:"can't download download counts, store will not have download count functionality"})})).then((()=>{fetch(ratings+"/ratings").then((e=>e.json())).then((e=>{data.ratings=e;let t=document.getElementById("sort");var a;"SEL"==t.tagName?((a=document.createElement("opt")).innerHTML='<i class="fas fa-star"></i>Ratings',a.setAttribute("value","ra"),t.querySelector("drop").appendChild(a)):((a=document.createElement("option")).innerText="Ratings",a.value="ra",t.add(a))})).catch((e=>{console.error(e),toast({class:"danger",text:"can't download download ratings, store will not have ratings functionality"})}))}))}))};e();var t=e=>{var t=null==e?"app":document.querySelector("#category .selected").dataset.name;document.getElementById("category").innerHTML="<style></style>";var a=[];a.push("app");for(let e in data.categories)a.push(data.categories[e].name);var l="";a.forEach(((e,n)=>{var o=document.getElementById("category"),r=document.createElement("button"),c=e.toLocaleLowerCase(),s="fas fa-store";try{s=data.categories[c].icon}catch(e){}"app"==e?r.innerText=" All Apps":(r.innerText=" "+e,null!=data.categories[c].description&&(r.title=data.categories[c].description));var d=document.createElement("i");d.className=s,r.insertBefore(d,r.childNodes[0]),r.dataset.name=c,l+=`[data-sel="${c}"] + #apps div.${c}:not(.hidden)`,n==a.length-1?l+="{ display: flex !important}":l+=",",o.parentElement.dataset.sel=t,o.appendChild(r)})),document.querySelector(`#category [data-name='${t}']`).className="selected",document.getElementById("category").querySelector("style").innerHTML=l,n(),document.getElementById("apps").children[0].innerHTML="";for(let e of data.apps){var r=document.createElement("div"),d=document.createElement("div");d.className="header";var i=document.createElement("img");i.src=e.icon,i.alt=" ",d.appendChild(i);var u=document.createElement("div");u.className="cat",u.innerText=e.meta.categories.map((e=>c(e))).join(", ");var p=document.createElement("div");p.className="na",p.innerText=e.name;var m=document.createElement("div");m.className="au",m.innerText=e.author[0].split("<")[0];var h=document.createElement("div");h.className="teco",h.appendChild(u),h.appendChild(p),h.appendChild(m),d.appendChild(h),r.appendChild(d),r.appendChild(document.createTextNode(s(e.description,206)));var g=document.createElement("div");if(g.className="spacer",r.appendChild(g),!isKai){var y=document.createElement("a");y.className="info",y.innerHTML='<i class="fas fa-info-circle"></i> Info',y.href=`#${e.slug}`;var f=document.createElement("a");f.href=e.download.url,f.innerHTML='<i class="fas fa-file-download"></i> Download';var v=document.createElement("button");v.className="share",v.innerHTML='<i class="far fa-clipboard"></i> Share';var E=document.createElement("div");E.className="bucon",E.appendChild(y),E.appendChild(f),E.appendChild(v),r.appendChild(E)}r.className="app",r.dataset.slug=e.slug;for(let t of e.meta.categories)r.classList.add(t);document.getElementById("apps").children[0].appendChild(r)}null!=e?location.hash="":(document.querySelector("#splash #image").className="loaded",document.getElementById("splash").style="opacity: 0; visibility: hidden"),isKai?document.querySelector(".app").classList.add("selected"):document.getElementById("le").innerText=document.querySelectorAll('[data-sel="app"] + #apps .app:not(.hidden)').length,""!=location.hash&&o(void 0)},a=0;function n(e){switch(data.apps.sort(((e,t)=>e.name.localeCompare(t.name))),document.getElementById("sort").selectedOptions?document.getElementById("sort").selectedOptions[0].value:document.querySelector("#sort cho").getAttribute("value")){case"cab":data.apps.sort(((e,t)=>e.meta.categories[0].localeCompare(t.meta.categories[0])));break;case"ra":data.apps.sort(((e,t)=>{var a=0;return!data.ratings[e.slug]||(data.ratings[t.slug]&&(a=data.ratings[t.slug].average_rating),data.ratings[e.slug].average_rating<a)}));break;case"pop":data.apps.sort(((e,t)=>{var a=0;return!data.dl[e.slug]||(data.dl[t.slug]&&(a=data.dl[t.slug]),data.dl[e.slug]<a)}))}null!=e&&e.target&&t(e)}window.addEventListener("DOMContentLoaded",(()=>{if((isKai?document.querySelector("sel"):document.querySelector("select")).remove(),"SELECT"==document.getElementById("sort").tagName&&(document.getElementById("sort").onchange=n),document.getElementById("category").onclick=e=>{let t=e.target;if("BUTTON"!=t.tagName)return;t.parentElement.parentElement.dataset.sel=t.dataset.name;for(let e of t.parentElement.children)e.removeAttribute("class");t.className="selected";let a=document.querySelectorAll(`[data-sel="${t.dataset.name}"] + #apps .${t.dataset.name}:not(.hidden)`);document.getElementById("le").innerText=a.length,isKai&&(document.querySelector(".app.selected").classList.remove("selected"),a[0].classList.add("selected"),setTimeout((()=>{let e=document.querySelector("#category button.selected").getBoundingClientRect(),t=e.left-document.body.getBoundingClientRect().left+e.width/2;document.getElementById("category").scrollBy({top:0,left:t-window.innerWidth/2,behavior:"smooth"})}),0))},isKai){var e=document.createElement("input");e.max=1,e.type="text",e.maxLength=0,e.id="secret",document.body.appendChild(e),e.focus(),e.onblur=()=>{setTimeout((()=>{e.focus()}),5)},window.addEventListener("keyup",(function(){window.fullScreen||document.documentElement.requestFullscreen()})),e.onkeydown=e=>{let t=e.key;"Backspace"==t&&e.preventDefault();let a=document.getElementById("barcontainer").dataset.sel,n=Array.from(document.querySelectorAll(`[data-sel="${a}"] + #apps div.${a}:not(.hidden)`)),l=n.indexOf(document.querySelector("#apps .app.selected")),o=Array.from(document.getElementById("category").children),r=o.indexOf(document.querySelector("#category button.selected")),c=Array.from(document.querySelectorAll("#appcard a,#img img:first-child")).filter((e=>function(e){let t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight-30&&t.right<=window.innerWidth}(e))),s=c.indexOf(document.querySelector("#appcard .selected")),d=Array.from(document.querySelectorAll("#appcard a,#img img")).indexOf(document.querySelector("#appcard .selected"));if(-1!=l){switch(t){case"ArrowDown":l!=n.length-1&&(document.querySelector(".app.selected").classList.remove("selected"),n[l+1].classList.add("selected"));break;case"ArrowUp":0!=l&&(document.querySelector(".app.selected").classList.remove("selected"),n[l-1].classList.add("selected"));break;case"Backspace":document.exitFullscreen(),location="about:blank";break;case"ArrowLeft":0!=r&&o[r-1].click();break;case"ArrowRight":r!=o.length-1&&o[r+1].click();break;case"Enter":return void(location.hash="#"+document.querySelector("#apps .app.selected").dataset.slug)}setTimeout((()=>{let e=document.querySelector("#apps .app.selected").getBoundingClientRect(),t=e.top-document.body.getBoundingClientRect().top+e.height/2;document.getElementById("container").scrollBy({left:0,top:t-window.innerHeight/2,behavior:"smooth"})}),0)}else if(""!=location.hash){if(-1!=d){let e=document.getElementById("appcard"),a=()=>{""!=document.getElementById("scrp").className&&(document.getElementById("scrp").className="")};switch(t){case"ArrowDown":e.scrollBy({left:0,top:100,behavior:"smooth"}),a();break;case"ArrowUp":e.scrollBy({left:0,top:-100,behavior:"smooth"}),a()}}if(-1!=s){let e=()=>document.querySelectorAll("#appcard .selected").forEach((e=>e.classList.remove("selected")));switch(t){case"ArrowUp":0!=s&&(e(),c[s-1].classList.add("selected"));break;case"ArrowDown":s!=c.length-1&&(e(),c[s+1].classList.add("selected"))}}else c.length>0&&t.match(/ArrowUp|ArrowDown/g)&&(document.querySelectorAll("#appcard .selected").forEach((e=>e.classList.remove("selected"))),c[0].classList.add("selected"));if("IMG"==document.querySelector("#appcard .selected").tagName){let e=()=>document.querySelectorAll("#appcard .selected").forEach((e=>e.classList.remove("selected"))),a=Array.from(document.querySelectorAll("#img img")),n=a.indexOf(document.querySelector("#appcard .selected")),l=()=>{setTimeout((()=>{let e=document.querySelector("#appcard .selected").getBoundingClientRect(),t=e.left-document.body.getBoundingClientRect().left+e.width/2;document.getElementById("img").scrollBy({top:0,left:t-window.innerWidth/2,behavior:"smooth"})}),0)},o=()=>{let e=document.getElementById("scrp"),t=document.querySelector("#appcard img.selected");"full"==e.className&&t&&(e.src=t.src)};switch(t){case"ArrowRight":n!=a.length-1&&(e(),a[n+1].classList.add("selected"),l(),o());break;case"ArrowLeft":0!=n&&(e(),a[n-1].classList.add("selected"),l(),o());break;case"Enter":case"Backspace":if("Backspace"==t&&""==document.getElementById("scrp").className)return void(location.hash="");document.getElementById("scrp").classList.toggle("full"),o()}}else document.getElementById("img").scrollTo({left:0}),"Backspace"==t&&(location.hash="")}}}else{var t=document.createElement("button");t.id="scrollup";var a=document.createElement("i");a.className="fas fa-chevron-up",t.appendChild(a),document.body.appendChild(t),/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())?t.style.transform="none":document.getElementById("apps").addEventListener("wheel",(function(e){if(0!=document.body.scrollTop)if(e.deltaY<0&&"translateY(70px)"==t.style.transform)t.style.transform="none";else{if(!(e.deltaY>0&&"none"==t.style.transform))return;t.style.transform="translateY(70px)"}else t.style.transform="translateY(70px)"})),document.getElementById("search").oninput=e=>{let t=e.target.value.toLocaleLowerCase();""==t&&document.querySelectorAll(".hidden").forEach((e=>e.classList.remove("hidden"))),document.querySelectorAll(".app").forEach((e=>{let a=e.dataset.slug,n=data.apps.find((e=>e.slug==a));(n.description+n.meta.tags+n.name+n.author).replace(/[; .]/g,"").replace(/<(.*)/g,"").toLowerCase().includes(t)?e.classList.remove("hidden"):e.classList.add("hidden")}));let a=document.getElementById("barcontainer").dataset.sel;document.getElementById("le").innerText=document.querySelectorAll(`[data-sel="${a}"] + #apps div.${a}:not(.hidden)`).length}}})),document.onclick=e=>{if("OPT"==e.target.tagName){document.activeElement.blur();let t=e.target.parentElement.parentElement.children[0];t.innerHTML="";for(let a of e.target.childNodes){let e=a.cloneNode(!0);t.appendChild(e)}t.setAttribute("value",e.target.getAttribute("value")),n(e)}else"share"==e.target.className?d(location.origin+"/#"+e.target.parentElement.parentElement.dataset.slug):"scrollup"==e.target.id?document.body.scrollTo({top:0,behavior:"smooth"}):"cards"==e.target.id&&document.querySelector("#appcard .close").click()},window.onhashchange=o;var l=!1;function o(e){if(isKai&&""==location.hash)return document.querySelector("#appcard .selected").classList.remove("selected"),document.getElementById("cards").removeAttribute("style"),document.getElementById("appcard").removeAttribute("style"),document.body.style.overflow="auto",document.querySelector(`[data-slug='${e.oldURL.split("#")[1]}']`).classList.add("selected"),void setTimeout((()=>{let e=document.querySelector("#apps .app.selected").getBoundingClientRect(),t=e.top-document.body.getBoundingClientRect().top+e.height/2;document.getElementById("container").scrollBy({left:0,top:t-window.innerHeight/2,behavior:"smooth"})}),0);let t=location.hash.split("#")[1],a=document.querySelector(`.app[data-slug="${t}"]`);var n=200;if("app"==document.querySelector("#category").dataset.sel&&(n=0),null!=a&&""!=location.hash&&(null==e&&document.querySelector("button[data-name=app]").click(),setTimeout((()=>{var e=a.getBoundingClientRect(),t=e.top-document.body.getBoundingClientRect().top+e.height/2;document.body.scrollBy({left:0,top:t-window.innerHeight/2,behavior:"smooth"})}),n)),l&&""==location.hash)return void document.querySelector("#appcard .close").click();let o=data.apps.find((e=>e.slug==t));if(null==o)return;document.body.style.overflow="hidden";let d=document.getElementById("appcard");d.scrollTo({top:0}),d.querySelector("#head img").src="",d.querySelector("#head img").src=o.icon,d.querySelector("#head img").alt="e",d.querySelector("#boxue #na").innerText=o.name,d.querySelector("#boxue #ca").innerText=o.meta.categories.map((e=>c(e))).join(", "),d.querySelector("#boxue #de").innerText=o.author[0].split("<")[0];for(let e of d.querySelectorAll("#ave #to, #appcard > #de"))for(let t of e.childNodes)null!=t.id&&null!=t.className||t.remove();for(let e of d.querySelectorAll("#scr #img,#bucon,#spe ul,#chat,#qrcode"))e.innerHTML="";d.querySelector("#appcard > #de").appendChild(document.createTextNode(o.description));var i=document.createElement("a");if(i.href=o.download.url,i.innerText="Download",d.querySelector("#bucon").appendChild(i),0==o.screenshots.length)d.querySelector("#scr").style.display="none";else{d.querySelector("#scr").style="display: block";for(let e of o.screenshots){var u=document.createElement("img");u.src=e,u.onerror=e=>{e.target.remove()},d.querySelector("#scr #img").appendChild(u)}}function p(e,t){var a=document.createElement("li"),n=document.createElement("div");n.className="a",n.innerText=e,a.appendChild(n);var l=document.createElement("div");if(l.className="b","string"==typeof t)l.innerText=t;else if(Array.isArray(t))for(let e of t)l.appendChild(e);else l.appendChild(t);return a.appendChild(l),a}isKai?d.querySelector("#qr").style.display="none":(d.querySelector("#qr").style.display="block",d.querySelector("#qrcode").appendChild(function(e,t){var a=qrjs(e),n=document.createElement("canvas");n.width=t,n.height=t;for(var l=n.getContext("2d"),o=a.modules,r=t/o.length,c=t/o.length,s=0;s<o.length;++s)for(var d=o[s],i=0;i<d.length;++i){l.fillStyle=d[i]?"#000":"#fff";var u=Math.ceil((i+1)*r)-Math.floor(i*r),p=Math.ceil((s+1)*c)-Math.floor(s*c);l.fillRect(Math.round(i*r),Math.round(s*c),u,p)}return n}(qr_prefix+o.slug,100)));var m=d.querySelector("#spe ul");for(let e of["author","maintainer"])if(o[e]){if(o[e][0].includes("<")&&1==o[e].length){var h=document.createElement("a");let t=o[e][0].split("<")[1].split(">")[0];o[e][0].includes("@")?h.href="mailto:"+t:h.href=t,h.target="_blank",h.innerText=o[e][0].split("<")[0],f=h}else 1!=o[e].length?(f=[],o[e].forEach(((t,a)=>{if(t.includes("<")){var n=document.createElement("a");let e=t.split("<")[1].split(">")[0];t.includes("@")?n.href="mailto:"+e:n.href=e,n.innerText=t.split("<")[0],n.target="_blank",f.push(n)}else f.push(document.createTextNode(t));a!=o[e].length-1&&f.push(document.createTextNode(", "))}))):o[e][0].includes("<")||1!=o[e].length||(f=o[e][0]);var g="author"==e?"Developers":"Maintainers";m.appendChild(p(g,f))}for(let e of["website","git_repo","donation"])if(o[e]){var y=document.createElement("a");y.innerText=o[e],y.target="_blank",y.href=o[e];g="Repository";switch(e){case"website":case"donation":g=c(e)}m.appendChild(p(g,y))}if(last_check[o.slug]&&m.appendChild(p("Version",last_check[o.slug])),m.appendChild(p("Type",c(o.type))),o.locales&&m.appendChild(p("Languages",o.locales.join(", "))),m.appendChild(p("Anti-features",`Ads: ${o.has_ads}\n Tracking: ${o.has_tracking}`)),o.license){var f;if(o.license.includes("<")){h=document.createElement("a");let e=o.license.split("<")[1].split(">")[0];h.href=e,h.innerText=o.license.split("<")[0],h.target="_blank",f=h}else f=o.license;m.appendChild(p("License",f))}if(data.dl&&data.dl[o.slug]&&m.appendChild(p("Downloads",data.dl[o.slug].toString())),data.ratings&&data.ratings[o.slug]){let e=data.ratings[o.slug];d.querySelector("#ra").style.display="block",d.querySelector("#ave #sco").innerText=e.average_rating.toFixed("1"),d.querySelector("#ave #stars").style=`--stars:${e.average_rating/5*100}%`,d.querySelector("#ave #to").appendChild(document.createTextNode(`${e.rating_count} total`));for(let e of d.querySelectorAll("#cha *"))e.style="--to:0%";r(o.slug,((t,a)=>{if(location.hash=="#"+o.slug&&"eroor404"!=t){isKai||[1,2,3,4,5].forEach((a=>{let n=t.ratings.filter((e=>e.points==a)).length;d.querySelector(`#appcard [data-r="${a}"]`).style=`--to:${n/e.rating_count*100}%`}));let a=d.querySelector("#chat");for(let e of t.ratings){var n=document.createElement("div"),l=document.createElement("div");l.className="tie";var r=14;if(isKai&&(r=6),l.appendChild(document.createTextNode(`@${s(e.username,r)}`)),isKai)l.appendChild(document.createTextNode(`   ${e.points} ★   `)),l.appendChild(document.createTextNode(new Date(1e3*e.creationtime).toLocaleDateString()));else{var c=document.createElement("div");c.id="stars",c.style=`--stars:${e.points/5*100}%`,l.appendChild(c),l.appendChild(document.createTextNode(new Date(1e3*e.creationtime).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})))}n.appendChild(l),n.appendChild(document.createTextNode(e.description)),a.appendChild(n)}}}))}else d.querySelector("#ra").style.display="none";document.getElementById("cards").style="opacity:1;visibility:visible",document.getElementById("appcard").style="transform:translate(50%, -50%)",l=!0,isKai?""!=location.hash&&(document.querySelector(".app.selected").classList.remove("selected"),document.querySelector("#appcard a,#img img").classList.add("selected")):document.querySelector("#appcard .close").addEventListener("click",(function e(){document.querySelector("#appcard .close").removeEventListener("click",e),l=!1,location.hash="",document.getElementById("cards").removeAttribute("style"),document.getElementById("appcard").removeAttribute("style"),document.body.style.overflow="auto"}))}function r(e,t){fetch(`${ratings}/ratings/${e}`).then((e=>e.json())).then((e=>t(e))).catch((e=>t("eroor404",e)))}toast=e=>{if(!isKai)try{let r=Object.keys(e);var t=document.getElementById("notif"),a=document.createElement("div"),n=null;function l(){a.style.animation="fadeout ease .4s",a.onanimationend=()=>a.remove()}if(r.includes("text")&&(a.innerText=e.text),r.includes("delay")&&(n=setTimeout(l,1e3*e.delay)),r.includes("element"))return void t.appendChild(e.element);var o=document.createElement("button");o.id="close",o.innerHTML="<i class='fas fa-times'></i>",r.includes("cb")?o.onclick=e.cb:o.onclick=()=>{null!=n&&clearTimeout(n),l()},r.includes("class")&&(a.className=e.class),a.appendChild(o),t.appendChild(a)}catch(e){}};var c=([e,...t],a=navigator.language)=>e.toLocaleUpperCase(a)+t.join(""),s=(e,t)=>e.length>t?e.substr(0,t-1)+"…":e;function d(e){if(navigator.clipboard)navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(e){console.error("Async: Could not copy text: ",e)}));else{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var a=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+a)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}}window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);